package com.h.demo.controller;

import java.util.ArrayList;
import java.util.Optional;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.PutMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;
import com.h.demo.Service.GuestdetailsService;

import com.h.demo.model.Trainhistory;



@RestController
@RequestMapping(value="/Train")
public class GuestdetailsController {

	
	@PostMapping(value="/addtrain")
	public String Addtrain(@RequestBody Trainhistory train) {
		String result="nothing happened";
		try {
			if(train.getTrain_name()=="" || train.getTrain_name()==null) {
				throw new TrainException("train name should not be empty");
			}else if(Checkbytrainname(train.getTrain_name().toLowerCase())) {
				throw new TrainException("Train name already exists");
			}else if( train.getRoute()==null) {
				throw new TrainException("route should be defined");
			}else if(train.getRoute()!=null) {
				if(train.getRoute().size()<=1) {
					throw new TrainException("minimum two station should be added");
				}
			}
		}catch(TrainException e) {
			result=e.getMessage();
		}
		if(result.equals("nothing happened")) {
			train.setTrain_name(train.getTrain_name().toLowerCase());
			train.setFrom(train.getRoute().get(0));
			train.setTo(train.getRoute().get(train.getRoute().size()-1));
			ArrayList<String> stations=new ArrayList<>();
			for(int i=0;i<train.getRoute().size();i++) {
				stations.add(train.getRoute().get(i).toLowerCase());
			}
			train.setRoute(stations);
			service.addtrain(train);
			result="Train details added successfully";
		}
		return result;
	}

	public boolean Checkbytrainname(String train_name) {
		Optional<Trainhistory> train;
		train=service.getbytrainname(train_name);
		if(train.isEmpty()) {
			return false;
		}else {
			return true;
		}
	}
}





package com.h.demo.Service;


import java.util.ArrayList;
import java.util.Optional;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import com.h.demo.Repository.GuestdetailsRepo;
import com.h.demo.model.Trainhistory;

@Service
public class GuestdetailsService {

	@Autowired
	private GuestdetailsRepo repo;

	@Autowired
	private SequenceGeneratorService sequenceService;
	
	public Optional<Trainhistory> getbytrainnumber(Long train_no) {
		Optional<Trainhistory> train=null;
		train=repo.findByTrain_no(train_no);
		return train;
	}

	
	public void addtrain(Trainhistory train) {
		train.setTrain_no(sequenceService.generateSequence(Trainhistory.SEQUENCE_NAME));
		repo.save(train);
		
	}
	